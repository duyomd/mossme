const DELAY_PERIOD=370;let MSG_PARALLELES_LOADING,MSG_PARALLELES_PATIENT,MSG_PARALLELES_ERROR,MSG_PARALLELES_FAILED,MSG_MONO_MONOLINGUAL,MSG_MONO_BILINGUAL,MSG_COMMENTARY_HIDDEN,MSG_COMMENTARY_DISPLAY,MSG_EXPAND_ALL,MSG_COLLAPSE_ALL,MSG_TOGGLE_NODE,ENTRY_COUNT,TRANSLATIONS_DEFAULT,TRANSLATIONS_ALL,COMMENTARIES_DEFAULT,COMMENTARIES_ALL,ANCHOR;function articleGlobal(e){MSG_PARALLELES_LOADING=e.MSG_PARALLELES_LOADING,MSG_PARALLELES_PATIENT=e.MSG_PARALLELES_PATIENT,MSG_PARALLELES_ERROR=e.MSG_PARALLELES_ERROR,MSG_PARALLELES_FAILED=e.MSG_PARALLELES_FAILED,MSG_MONO_MONOLINGUAL=e.MSG_MONO_MONOLINGUAL,MSG_MONO_BILINGUAL=e.MSG_MONO_BILINGUAL,MSG_COMMENTARY_HIDDEN=e.MSG_COMMENTARY_HIDDEN,MSG_COMMENTARY_DISPLAY=e.MSG_COMMENTARY_DISPLAY,MSG_EXPAND_ALL=e.MSG_EXPAND_ALL,MSG_COLLAPSE_ALL=e.MSG_COLLAPSE_ALL,ENTRY_COUNT=e.ENTRY_COUNT,ANCHOR=e.ANCHOR,TRANSLATIONS_DEFAULT=e.TRANSLATIONS_DEFAULT,TRANSLATIONS_ALL=e.TRANSLATIONS_ALL,COMMENTARIES_DEFAULT=e.COMMENTARIES_DEFAULT,COMMENTARIES_ALL=e.COMMENTARIES_ALL}var _firstLoad=!0,_bilingual=!1,_parallelsOns=Array(ENTRY_COUNT);for(let i=0;i<_parallelsOns.length;i++)_parallelsOns[i]=!1;function loadParallels(e,t){if(!_parallelsOns[t]){loading(!0);var n=document.querySelector(".parallels-title-"+t),l=document.querySelector(".parallels-content-"+t);parallelsSearching(n,l);var r=new XMLHttpRequest;r.onreadystatechange=function(){try{4==this.readyState&&(200==this.status?(parallelsResult(n,l,this.responseText),_parallelsOns[t]=!0):parallelsError(n,l),loading(!1))}catch(e){parallelsError(n,l),loading(!1)}},r.open("GET","/parallels="+e,!0),r.send()}}function parallelsSearching(e,t){e.innerHTML=MSG_PARALLELES_LOADING,t.innerHTML=MSG_PARALLELES_PATIENT,t.classList.remove("d-none")}function parallelsResult(e,t,n){let l=' target="_blank" rel="noreferrer noopener" ';for(var r=JSON.parse(n),o=r.urls,a=r.msg,s="",c=0;c<o.length;c++)if(par=o[c],s.length>0&&(s+=", "),par.url)s+='<a href="'+par.url+'"'+l+">"+par.entry_id+"</a>";else{let L=par.entry_id.toLowerCase();startsWithAnyOfArr(L,["kd","mvu","sht"])?s+="<span>"+par.entry_id+"</span>":s+='<a class="ref" href="https://suttacentral.net/'+L+'"'+l+">"+par.entry_id+"</a>"}t.classList.add("text-uppercase"),t.innerHTML=s,e.innerHTML=a}function parallelsError(e,t){t.innerHTML=MSG_PARALLELES_ERROR,e.innerHTML=MSG_PARALLELES_FAILED,e.parentElement.removeAttribute("href"),e.parentElement.removeAttribute("onclick")}function gotoCmt(){var e=document.getElementById("commentary");e&&e.className&&hasClass(e,"collapse show")&&(window.location.href="#commentary")}function commentary(e){if(e){document.getElementById(e.id).classList.add("disabled");var t="";hasClass(e,"active")?(loopToggleCss(Array(e.id),"active","inactive"),t=MSG_COMMENTARY_HIDDEN):(loopToggleCss(Array(e.id),"inactive","active"),t=MSG_COMMENTARY_DISPLAY),setToastMessage(t),setTimeout(function(){gotoCmt(),document.getElementById(e.id).classList.remove("disabled")},370)}}function bilingual(e){var t=document.querySelectorAll("#col-main");if(null!=t&&!(t.length<=0)){for(var n=document.querySelectorAll("#col-sub"),l=!hasClass(n[0],"hidden"),r=0;r<t.length;r++){let o=t[r],a=n[r];l?(o.className="",a.className="hidden"):(o.className="col-6",a.className="col-6")}if(e){var s="";l?(loopToggleCss(Array(e.id),"active","inactive"),s=MSG_MONO_MONOLINGUAL):(loopToggleCss(Array(e.id),"inactive","active"),s=MSG_MONO_BILINGUAL),setToastMessage(s),window.location.href="#article"}}}function selectDropdownItem(e,t,n){if(t){var l=1==e?"link-main-"+n:2==e?"link-sub-"+n:null;null!=l&&(loopToggleCssByElements(document.querySelectorAll("."+l),"active",""),loopToggleCssByElements(Array(t),"","active"))}}function reloadContent(e,t,n){if(!t)return;if(1==e)l=document.querySelectorAll("#title-main")[n],r=document.querySelectorAll("#content-main")[n],o=document.querySelectorAll("#dropdown-main")[n].children[0];else if(2==e)l=document.querySelectorAll("#title-sub")[n],r=document.querySelectorAll("#content-sub")[n],o=document.querySelectorAll("#dropdown-sub")[n].children[0];else{if(3!=e)return;l=document.querySelectorAll("#title-comm")[n],r=document.querySelectorAll("#content-comm")[n],o=document.querySelectorAll("#dropdown-comm")[n].children[0]}l&&(l.innerHTML=t.title,l.lang=t.lang),o.innerHTML=t.author;var l,r,o,a=TRANSLATIONS_ALL;3==e&&(a=COMMENTARIES_ALL);let s=a[n].get(t.id);if(s&&s.content&&s.content.length>0){let c=document.createElement("textarea");c.innerHTML=s.content,r.innerHTML=c.value,r.lang=s.lang,c.remove()}else loadContent(e,t.id,r,n);loadWindowLocation(e,t)}function loadWindowLocation(e,t){if(window.location.href.indexOf("article-group")>0)return;let n=new URL(window.location.href);(1==e||2==e)&&(n.searchParams.set("tid",t.id),n.searchParams.set("lang",t.lang)),(_firstLoad||3==e)&&1!=e||(n.searchParams.delete("anchor"),n.searchParams.delete("aid"),n.hash="",window.history.pushState({tid:t.id},"",n))}function loadContent(e,t,n,l){loading(!0);var r=new XMLHttpRequest;r.onreadystatechange=function(){try{if(4==this.readyState){if(200==this.status){var r=JSON.parse(this.responseText);r&&(3==e?COMMENTARIES_ALL[l].set(t,r):TRANSLATIONS_ALL[l].set(t,r),n.innerHTML=r.content,n.lang=r.lang)}loading(!1)}}catch(o){loading(!1)}},r.open("GET","/articleContent/type="+e+"/id="+t,!0),r.send()}function initContent(e,t){if(e&&!(e.length<=0)){for(var n=0;n<e.length;n++)e[n].author&&(reloadContent(1,e[n],n),reloadContent(2,e[n],n));if(t&&!(t.length<=0))for(var n=0;n<t.length;n++)t[n].author&&reloadContent(3,t[n],n)}}function initToastArticle(){initToast(["btn-commentary","btn-bilingual"])}function initDefaultState(){ANCHOR&&"commentary"==ANCHOR&&document.getElementById("btn-commentary").click()}function dropdownOverflow(){dropdownArticle(),dropdownCommentary()}function dropdownArticle(){let e=document.querySelectorAll("#dd-article");if(!e||e.length<=0)return;let t=document.querySelector("#article");for(var n=0;n<e.length;n++){let l=e[n];l.addEventListener("show.bs.dropdown",()=>{t.style.overflow="auto"}),l.addEventListener("hide.bs.dropdown",()=>{t.style.overflow="hidden"})}}function dropdownCommentary(){let e=document.querySelector("#dd-commentary");if(!e)return;let t=document.querySelector("#commentary");e.addEventListener("show.bs.dropdown",()=>{document.head.appendChild(document.createElement("style")).innerHTML=".commentary:before {position: fixed;}",t.style.overflow="auto"}),e.addEventListener("hide.bs.dropdown",()=>{var e=document.getElementsByTagName("style");for(let n=0;n<e.length;n++)e[n].remove();t.style.overflow="hidden"})}function initArticle(){initToastArticle(),initContent(TRANSLATIONS_DEFAULT,COMMENTARIES_DEFAULT),initDefaultState(),dropdownOverflow(),_firstLoad=!1}const SUFFIX_TOGGLE="-tree-i",SUFFIX_SUBTREE="-tree-ul",CSS_SHOW="show",CSS_SUBTREE="content-list-tree",CSS_EXPANDING="bi-dash-square",CSS_COLLAPSING="bi-plus-square-fill",MAX_CONCURRENT_REQUESTS=5;let requestQueue=[],activeRequests=0;var _treemap=new Map;function getTreeElement(e,t){return document.getElementById(e.replaceAll(".","\\.")+t)}function getEidFromTreeElement(e,t){return e.id.slice(0,-1*t.length)}function getToggleElement(e){return getTreeElement(e,SUFFIX_TOGGLE)}function getSubtreeElement(e){return getTreeElement(e,SUFFIX_SUBTREE)}function expandCss(e){getSubtreeElement(e).classList.add(CSS_SHOW),getToggleElement(e).classList.replace(CSS_COLLAPSING,CSS_EXPANDING)}function collapseCss(e){getSubtreeElement(e).classList.remove(CSS_SHOW),getToggleElement(e).classList.replace(CSS_EXPANDING,CSS_COLLAPSING)}function queueRequest(e,t){requestQueue.push({eId:e,isRecursive:t}),processQueue()}function processQueue(){if(activeRequests>=5||0===requestQueue.length)return;let{eId:e,isRecursive:t}=requestQueue.shift();activeRequests++,fetchChildNodes(e,t).finally(()=>{activeRequests--,processQueue()})}function toggleNode(e,t){getToggleElement(e).classList.contains(CSS_COLLAPSING)?queueRequest(e,t):closeNode(e)}function openNode(e,t){let n=getSubtreeElement(e).children;if(0==n.length)queueRequest(e,t);else{if(t)for(let l=0;l<n.length&&Array.from(n[l].children).some(e=>e.classList.contains(CSS_SUBTREE))&&!(n[l].children.length<3);l++)openNode(getEidFromTreeElement(n[l].querySelector("."+CSS_SUBTREE),SUFFIX_SUBTREE),t);expandCss(e)}}function closeNode(e){collapseCss(e)}function fetchChildNodes(e,t){return new Promise((n,l)=>{if(!e)return n();if(_treemap.get(e))return expandCss(e),n();_treemap.set(e,!0),loading(!0);var r=new XMLHttpRequest;r.onreadystatechange=function(){try{if(4==this.readyState){if(200==this.status){let r=JSON.parse(this.responseText);printChildNodes(e,r,t),n()}else l();loading(!1)}}catch(o){loading(!1),l(o)}},r.open("GET","/openFolder/"+e,!0),r.send()})}function printChildNodes(e,t,n){let l=getSubtreeElement(e),r=document.createDocumentFragment();for(let o=0;o<t.length;o++){let a=t[o],s=document.createElement("li"),c="",L=0==a.type;L&&(c+='<a role="button" href="javascript:void(0)" aria-label="'+MSG_TOGGLE_NODE+'"><i id="'+a.entry_id+SUFFIX_TOGGLE+'" data-bs-toggle="collapse" href="#'+a.entry_id+SUFFIX_SUBTREE+'"class="d-inline bi '+CSS_COLLAPSING+'" onclick="toggleNode(`'+a.entry_id+'`, false)"></i></a>'),c+='<a href="/article/'+a.entry_id+'"><span class="'+(L?"tree-folder":"tree-leaf")+'">'+a.enum_title+"</span></a>",L&&(c+='<ul id="'+a.entry_id+SUFFIX_SUBTREE+'" class="content-list '+CSS_SUBTREE+' collapse"></ul>'),s.innerHTML=c,r.appendChild(s)}if(l.appendChild(r),expandCss(e),n)for(let S=0;S<t.length;S++){let d=t[S];0==d.type&&openNode(d.entry_id,n)}}function toggleAllNodes(){let e=document.getElementById("btn-toggle-all");e&&(e.classList.contains("bi-grid-3x3-gap-fill")?(expandAll(),e.nextElementSibling.innerHTML=MSG_COLLAPSE_ALL):(collapseAll(),e.nextElementSibling.innerHTML=MSG_EXPAND_ALL),e.classList.toggle("bi-grid-3x3-gap-fill"),e.classList.toggle("bi-grid-3x3-gap"))}function expandAll(){let e=document.querySelectorAll(".tree-folder-no-parent");for(let t=0;t<e.length;t++)openNode(getEidFromTreeElement(e[t],SUFFIX_TOGGLE),!0)}function collapseAll(){let e=document.querySelectorAll("."+CSS_SUBTREE);for(let t=1;t<e.length;t++)closeNode(getEidFromTreeElement(e[t],SUFFIX_SUBTREE))}document.addEventListener("DOMContentLoaded",function(){scrollToSectionWorkaround(),addEvent(window,"load",initArticle)});