var FIELDS_FETCH,FIELDS_TABLE,FIELDS_TABLE_HEADER,FIELDS_TABLE_ORDERBYS,RADIO_SHOW_BUTTON_IDS,_noRadio,_noMove,_currentSort;let MSG_RPP,MSG_FORWARD_SLASH,MSG_MOVE_UP,MSG_MOVE_DOWN,PAGINATION_RPPS,PAGINATION_MAX_NUM;const HIDDEN_KEY_COL_INDEX=0,CONTENT_FIELD="field",CONTENT_FIELD_EXTRA_SORT="fieldExtraSort",CONTENT_FIELD_EXTRA="fieldExtra",CONTENT_FIELD_EXTRA_HASH="fieldExtraHash",CONTENT_FIELD_EXTRA_END="fieldExtraEnd",CONTENT_FIELD_EXTRA_ONCLICK="fieldExtraOnclick",CONTENT_FIELD_BOX_LABELS="fieldBoxLabels",CONTENT_FIELD_BOX_HREFS="fieldBoxHrefs",CONTENT_FIELD_STICKY="fieldSticky",CONTENT_FIELD_TRIM="fieldTrim",CONTENT_FIELD_SHORT_URL="fieldShortUrl",CONTENT_TYPE="type",CONTENT_TYPES={LINK:"link",IMAGE:"image",BOX:"box",TEXT:"text"};let _url;function changeRpp(e){loading(!0);var t=new XMLHttpRequest;t.onreadystatechange=function(){try{4==this.readyState&&(200==this.status&&(loadTable(parseAjaxResponse(this.responseText)),callbackFunc(!1)),loading(!1))}catch(e){loading(!1)}},t.open("GET","/rpp="+e+"/conditions="+getConditions()+"/url="+_url,!0),t.send()}function changePage(e,t,a){loading(!0);var n=new XMLHttpRequest;n.onreadystatechange=function(){try{4==this.readyState&&(200==this.status&&(loadTable(parseAjaxResponse(this.responseText)),callbackFunc(!1)),loading(!1))}catch(e){loading(!1)}},n.open("GET","/"+_url+"/p="+e+"/orderby="+t+"/sortorder="+a+"/conditions="+getConditions(),!0),n.send()}function getConditions(){var e=document.getElementById("conditions").value;return null==e||e.length<=0?"-1":e}function toggleMoveBtns(e,t){!_noMove&&String(e.orderBys).startsWith(FIELDS_TABLE[FIELDS_TABLE.length-1].CONTENT_FIELD)&&(loopToggleCss(["btn-move-up","btn-move-down"],"disabled",""),!e.hasPrevious&&document.getElementById("selected_index").value<=0&&loopToggleCss(["btn-move-up"],"","disabled"),e.hasNext||null!=t.nextElementSibling||loopToggleCss(["btn-move-down"],"","disabled"))}function setMode(e){loading(!0),document.getElementById("mode").value=e;var t=document.querySelector(".table").children[1].children.length,a=document.getElementById("currentPage"),n=document.getElementById("selected_index");switch(e){case"delete":_currentSort.currentPage>1&&t<=2&&(a.value=_currentSort.currentPage-1);break;case"modify":break;case"move-up":n.value<=0?(a.value=_currentSort.currentPage-1,n.value=_currentSort.rpp-1):n.value=parseInt(n.value)-1;break;case"move-down":n.value>=_currentSort.rpp-1?(a.value=_currentSort.currentPage+1,n.value=0):n.value=parseInt(n.value)+1;break;case"search":a.value=1}}function clickBtn(e){document.querySelector(e).click()}function selectRow(e,t){if(e&&!_noRadio){var a=this.event;if(void 0===a&&(a=window.event),!(a&&a.srcElement&&(a.srcElement.classList.contains("cancel-row-selected")||a.srcElement.classList.contains("folder")||"A"==a.srcElement.tagName))){loading(!0);try{e.children[0].children[0].checked=!0,document.getElementById("selected_key").value=e.children[1].childNodes[0].nodeValue.trim(),document.getElementById("selected_index").value=t,loopToggleCssByElements(e.parentNode.children,"table-active",""),loopToggleCssByElements(Array(e),"","table-active"),toggleMoveBtns(_currentSort,e),getItem(e)}catch(n){loading(!1)}}}}function reSelectRow(e){selectRow(document.querySelector(".table").children[1].children[parseInt(e)+1],e)}function getItem(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==this.readyState){if(200==this.status){var e=JSON.parse(this.responseText);if(!e)return;for(let t=0;t<FIELDS_FETCH.length;t++){var a=document.querySelectorAll("#"+FIELDS_FETCH[t]);for(let n=0;n<a.length;n++)a[n].value=unescapeSlashes(e[FIELDS_FETCH[t]])}loopToggleCss(["btn-modify","btn-delete"],"hidden","d-inline-block"),callbackFunc(!0)}loading(!1)}};let a=encodeURIComponent(document.getElementById("selected_key").value);t.open("GET","/"+_url+"/"+a,!0),t.send()}function callbackFunc(e){"function"==typeof extraCallback&&extraCallback(e)}function updateSortForPost(e){document.getElementById("currentPage").value=e.currentPage,document.getElementById("orderBys").value=e.orderBys.toString(),document.getElementById("sortOrders").value=e.sortOrders.toString()}function updateSearchForPost(e){e&&(document.getElementById("conditions").value=e)}function resetForm(){if(RADIO_SHOW_BUTTON_IDS)for(var e=0;e<RADIO_SHOW_BUTTON_IDS.length;e++){var t=document.getElementById(RADIO_SHOW_BUTTON_IDS[e]);t&&(t.className=t.className.replaceAll("d-inline-block","hidden"))}let a=document.getElementById("input-form-container");a&&a.children[0].reset()}function rppOverflow(){let e=document.querySelector("#rpp-dropdown");e&&(e.addEventListener("show.bs.dropdown",()=>{document.querySelector(".table-responsive").style="overflow:inherit"}),e.addEventListener("hide.bs.dropdown",()=>{document.querySelector(".table-responsive").style="overflow:auto"}))}function oncompleteLoadTable(e){_noRadio||(e?reSelectRow(e):resetForm()),rppOverflow()}function unescapeSlashes(e){if(e)try{return e.replace(/(?:\\(.))/g,"$1")}catch(t){return e}return""}function parseAjaxResponse(e){for(var t=JSON.parse(e),a=t.items,n=[],r=0;r<a.length;r++){let o={};for(let l=0;l<FIELDS_FETCH.length;l++){let s=FIELDS_FETCH[l];o[s]=a[r][s]}n.push(o)}var i=t.sort,c={rpp:i.rpp,currentPage:i.currentPage,pageTotal:i.pageTotal,orderBys:i.orderBys,sortOrders:i.sortOrders,hasPrevious:i.currentPage>1,hasNext:i.currentPage<i.pageTotal};return updateSortForPost(c),updateSearchForPost(t.conditions),{items:n,sort:c,newSelectedIndex:t.newSelectedIndex}}function loadTable(e){var t=e.items,a=e.sort;_currentSort=a;for(var n=0==a.sortOrders.length?"ASC":"ASC"==a.sortOrders[0]?"DESC":"ASC",r=Array.from(a.sortOrders),o=0;o<r.length;o++)r[o]=n;var l=a.orderBys.length<1?null:a.orderBys[0],s=e.newSelectedIndex;if(t){var i='<table class="table table-dark table-striped"><thead>'+htmlTableHeader(a,r,l)+"</thead><tbody>"+htmlTableMoveBtnsRow(a)+htmlContentRows(t)+'</tbody><tfoot id="table-footer"><tfoot></table>';document.querySelector(".table-responsive").innerHTML=i,document.getElementById("table-footer").innerHTML=htmlTableFooter(a),oncompleteLoadTable(s)}}function htmlTableHeader(e,t,a){var n="<tr>";_noRadio||(n+='<th scope="col" data-field="state" data-radio="true"></th>');for(let r=0;r<FIELDS_TABLE_HEADER.length;r++){let o="";r==HIDDEN_KEY_COL_INDEX&&(o+="hidden"),FIELDS_TABLE[r].CONTENT_FIELD_STICKY&&(o+=" col-sticky");let l=a;FIELDS_TABLE[r].CONTENT_FIELD_EXTRA_SORT&&e.orderBys.includes(FIELDS_TABLE[r].CONTENT_FIELD_EXTRA_SORT.toLowerCase())&&(l=FIELDS_TABLE[r].CONTENT_FIELD_EXTRA_SORT.toLowerCase());let s=FIELDS_TABLE[r].CONTENT_FIELD.toLowerCase();s.indexOf(".")>=0&&(s=s.substr(s.indexOf(".")+1)),n+='<th scope="col" class="'+o+'"><a role="button" href="javascript:void(0)" onclick="changePage('+e.currentPage+",'"+FIELDS_TABLE_ORDERBYS[r]+"','"+t.toString()+"')\">"+FIELDS_TABLE_HEADER[r]+(l==s?' <i class="bi bi-small '+("DESC"==t[0]?"bi-caret-up-fill":"bi-caret-down-fill")+'"></i>':"")+"</a></th>"}return _noMove||(n+='<th scope="col"></th>'),n+="</tr>"}function htmlTableMoveBtnsRow(e){var t="<tr>";for(let a=0;a<FIELDS_TABLE.length;a++)t+='<td class="p-0 border-0"'+(1==a?' hidden"':"")+"></td>";return _noMove||(t+='<td rowspan="'+(e.rpp+1)+'" class="align-middle text-center col-move"><a id="btn-move-up" role="button" onclick="clickBtn(\'#hdn-move-up\');" href="javascript:void(0)" class="btn-move animated fadeInUp disabled" aria-label="'+MSG_MOVE_UP+'"><i class="bi bi-chevron-double-up"></i></a><a id="btn-move-down" role="button" onclick="clickBtn(\'#hdn-move-down\');" href="javascript:void(0)" class="btn-move mt-2 animated fadeInUp disabled" aria-label="'+MSG_MOVE_DOWN+'"><i class="bi bi-chevron-double-down"></i></a>'),t+="</td></tr>"}function htmlContentRows(items){for(var html="",i=0;i<items.length;i++){var item=items[i];html+='<tr onclick="selectRow(this, '+i+')">',_noRadio||(html+='<td><input type="radio" name="radioGroup" aria-label="'+i+'"></td>');for(let j=0;j<FIELDS_TABLE.length;j++){let tdCss="";switch(FIELDS_TABLE[j].CONTENT_FIELD_STICKY&&(tdCss=' class="col-sticky" '),FIELDS_TABLE[j].CONTENT_TYPE){case CONTENT_TYPES.BOX:for(var box='<div class="dropdown entry-box"><a class="d-flex align-items-center dropdown-toggle cancel-row-selected" href="javascript:void(0)" role="button" data-bs-toggle="dropdown" data-bs-auto-close="true"><i><span class="cancel-row-selected">'+eval(unescapeSlashes(FIELDS_TABLE[j].CONTENT_FIELD))+'</span></i></a><ul class="dropdown-menu">',t=0;t<FIELDS_TABLE[j].CONTENT_FIELD_BOX_LABELS.length;t++)box+='<li><a class="dropdown-item text-truncate link-main" href="'+eval(FIELDS_TABLE[j].CONTENT_FIELD_BOX_HREFS[t])+'">'+eval(FIELDS_TABLE[j].CONTENT_FIELD_BOX_LABELS[t])+"</a></li>";box+="</ul></div>",html+="<td"+tdCss+">"+box+"</td>";break;case CONTENT_TYPES.LINK:FIELDS_TABLE[j].CONTENT_FIELD_SHORT_URL&&(tdCss=tdCss.length>0?tdCss.slice(0,tdCss.length-2)+" short-url"+tdCss.slice(tdCss.length-2):' class="short-url" ');let href="";hash="";let extra="",onclick="";null!=FIELDS_TABLE[j].CONTENT_FIELD_EXTRA&&(href=eval(FIELDS_TABLE[j].CONTENT_FIELD_EXTRA)),null!=FIELDS_TABLE[j].CONTENT_FIELD_EXTRA_HASH&&(hash="#"+eval(unescapeSlashes(FIELDS_TABLE[j].CONTENT_FIELD_EXTRA_HASH))),null!=FIELDS_TABLE[j].CONTENT_FIELD_EXTRA_END&&(extra=" "+unescapeSlashes(FIELDS_TABLE[j].CONTENT_FIELD_EXTRA_END)),null!=FIELDS_TABLE[j].CONTENT_FIELD_EXTRA_ONCLICK&&(onclick=' onclick="'+eval(unescapeSlashes(FIELDS_TABLE[j].CONTENT_FIELD_EXTRA_ONCLICK))+'"');let a='href="'+href+hash+'"'+extra+onclick,text=eval(unescapeSlashes(FIELDS_TABLE[j].CONTENT_FIELD));null==text&&(text=""),html+="<td"+tdCss+"><a "+a+">"+text+"</a></td>";break;case CONTENT_TYPES.IMAGE:let content=item[FIELDS_TABLE[j].CONTENT_FIELD];null!=FIELDS_TABLE[j].CONTENT_FIELD_EXTRA&&(content=eval(FIELDS_TABLE[j].CONTENT_FIELD_EXTRA)),html+="<td"+tdCss+">"+unescapeSlashes(content)+"</td>";break;case CONTENT_TYPES.FOLDER:break;default:let val=item[FIELDS_TABLE[j].CONTENT_FIELD];null!=FIELDS_TABLE[j].CONTENT_FIELD_EXTRA&&(val=eval(FIELDS_TABLE[j].CONTENT_FIELD_EXTRA)),j==HIDDEN_KEY_COL_INDEX&&(tdCss=' class="hidden" '),html+="<td"+tdCss+">",FIELDS_TABLE[j].CONTENT_FIELD_TRIM&&val&&(html+='<div class="trim" style="-webkit-line-clamp:'+FIELDS_TABLE[j].CONTENT_FIELD_TRIM+'">'),html+=unescapeSlashes(val),FIELDS_TABLE[j].CONTENT_FIELD_TRIM&&val&&(html+="</div>"),html+="</td>"}}html+="</tr>"}return html}function htmlTableFooter(e){return'<tr><td colspan="'+document.querySelector(".table-striped").children[0].children[0].children.length+'" class="text-end">'+htmlTableFooterRppSelect(e)+htmlTableFooterPagination(e)+"</td></tr>"}function htmlTableFooterRppSelect(e){var t='<div id="rpp-dropdown" class="dropdown dropup pt-1 float-start"><button class="btn btn-secondary dropdown-toggle" type="button"data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="true"><span>'+e.rpp+" "+MSG_RPP+'</span></button><ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="dropdown-main">';return PAGINATION_RPPS.forEach(a=>{t+='<li><span class="dropdown-item '+(e.rpp==a?"active":"")+'" onclick="'+(e.rpp!=a?"changeRpp("+a+")":"")+'">'+a+"</span></li>"}),t+="</ul></div>"}function htmlTableFooterPagination(e){var t='<div><nav aria-label="Page navigation"><div class="d-none d-md-block"><ul class="pagination justify-content-end mb-0">'+htmlTableFooterPaginationPrevious(e);return e.pageTotal<=PAGINATION_MAX_NUM?t+=htmlTableFooterPaginationLong(e):t+=htmlTableFooterPaginationShort(e),t+=htmlTableFooterPaginationNext(e)+'</ul></div><div class="d-sm-block d-md-none"><ul class="pagination justify-content-end mb-0">'+htmlTableFooterPaginationPrevious(e)+htmlTableFooterPaginationShort(e)+htmlTableFooterPaginationNext(e)+"</ul></div></nav></div>"}function htmlTableFooterPaginationPrevious(e){return'<li class="page-item '+(e.hasPrevious?"":"disabled")+'"><a role="button" class="page-link" aria-label="Previous" href="javascript:void(0)" onclick="changePage('+(e.currentPage-1)+", '"+e.orderBys.toString()+"', '"+e.sortOrders.toString()+'\')"><span aria-hidden="true">&laquo;</span></a></li>'}function htmlTableFooterPaginationNext(e){return'<li class="page-item '+(e.hasNext?"":"disabled")+'"><a role="button" class="page-link" aria-label="Next" href="javascript:void(0)" onclick="changePage('+(e.currentPage+1)+", '"+e.orderBys.toString()+"', '"+e.sortOrders.toString()+'\')"><span aria-hidden="true">&raquo;</span></a></li>'}function htmlTableFooterPaginationLong(e){for(var t="",a=1;a<=e.pageTotal;a++)t+='<li class="page-item"><a role="button" class="page-link '+(e.currentPage==a?"active":"")+'" href="javascript:void(0)"onclick="changePage('+a+", '"+e.orderBys.toString()+"', '"+e.sortOrders.toString()+"')\">"+a+"</a></li>";return t}function htmlTableFooterPaginationShort(e){return'<li class="page-item"><span class="page-link">'+(e.pageTotal<=0?0:e.currentPage)+MSG_FORWARD_SLASH+e.pageTotal+"</span></li>"}